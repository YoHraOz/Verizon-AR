<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verizon AR Demo</title>
    
    <!-- Google's <model-viewer> component -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    
    <style>
        :root {
            --verizon-red: #CD040B;
            --verizon-dark-red: #a3030a;
            --verizon-white: #ffffff;
            --verizon-black: #000000;
            --verizon-dark-grey: #1a1a1a;
            --verizon-light-grey: #f4f4f4;
            --success-green: #28a745; /* Keep for success states */
            --text-grey: #666666;
        }
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
            background-color: #fff;
            display: flex;
            flex-direction: row;
            overflow: hidden;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--verizon-dark-grey);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 1000;
        }
        .header span {
            color: var(--verizon-red);
        }
        
        /* Side Menu Styles */
        .side-menu {
            position: fixed;
            top: 60px;
            left: -320px;
            width: 320px;
            height: calc(100vh - 60px);
            background-color: #fff;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 999;
            overflow-y: auto;
        }
        .side-menu.open {
            left: 0;
        }
        
        .menu-toggle {
            position: fixed;
            top: 70px;
            left: 10px;
            background-color: var(--verizon-red);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
            font-size: 1.2em;
        }
        
        .menu-content {
            padding: 20px;
        }
        
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-top: 60px;
        }
        #viewer-container {
            flex-grow: 1;
            width: 100%;
            position: relative;
        }
        model-viewer {
            width: 100%;
            height: 100%;
            background-color: var(--verizon-light-grey);
            --ar-button-display: none; /* We use our own custom button */
        }
        /* Hotspot styles */
        .hotspot {
            display: block;
            width: 20px;
            height: 20px;
            border-radius: 10px;
            border: none;
            background-color: var(--verizon-red);
            cursor: pointer;
            position: relative;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(205, 4, 11, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(205, 4, 11, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(205, 4, 11, 0);
            }
        }
        
        .annotation {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .hotspot:hover .annotation {
            opacity: 1;
        }
        .controls {
            background-color: #fff;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .product-switcher {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .product-button {
            padding: 12px 20px;
            border: 1px solid #ccc;
            background-color: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            flex: 1;
            min-width: 0;
            text-align: center;
            font-weight: 500;
        }
        .product-button.active {
            background-color: var(--verizon-dark-grey);
            color: white;
            border-color: var(--verizon-dark-grey);
        }
        
        .product-info {
            background-color: var(--verizon-light-grey);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: left;
        }
        .product-info h3 {
            margin: 0 0 8px 0;
            color: var(--verizon-dark-grey);
            font-size: 1.3em;
        }
        .product-info p {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 1em;
            line-height: 1.4;
        }
        .price {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--verizon-red);
            margin-bottom: 15px;
        }
        
        .accessories-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .accessories-section h4 {
            margin: 0 0 15px 0;
            color: var(--verizon-dark-grey);
            font-size: 1.1em;
            font-weight: bold;
        }
        .accessories-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .accessory-item {
            display: flex;
            flex-direction: column;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: white;
            transition: all 0.2s;
        }
        .accessory-item:hover {
            border-color: var(--verizon-red);
            box-shadow: 0 2px 8px rgba(205, 4, 11, 0.1);
        }
        .accessory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .accessory-name {
            font-size: 1em;
            font-weight: 600;
            color: var(--verizon-dark-grey);
            flex: 1;
        }
        .accessory-price {
            font-size: 1em;
            font-weight: bold;
            color: var(--verizon-red);
        }
        .accessory-description {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }
        .add-accessory-btn {
            padding: 8px 16px;
            font-size: 0.9em;
            background-color: white;
            border: 2px solid var(--verizon-red);
            color: var(--verizon-red);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            align-self: flex-start;
        }
        .add-accessory-btn:hover {
            background-color: var(--verizon-red);
            color: white;
        }
        .add-accessory-btn.added {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }
        
        .ar-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--verizon-red);
        }
        
        #ar-button {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 15px 20px;
            font-size: 1.1em;
            font-weight: bold;
            background-color: var(--verizon-red);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(205, 4, 11, 0.3);
            transition: all 0.2s ease;
        }
        
        #ar-button:hover {
            background-color: var(--verizon-dark-red);
            box-shadow: 0 6px 16px rgba(205, 4, 11, 0.4);
            transform: translateY(-1px);
        }
        
        .ar-features {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .feature-btn {
            padding: 10px 20px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        .feature-btn:hover {
            background-color: var(--verizon-light-grey);
        }
        
        .ar-features {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        /* Interactive Features Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--verizon-red);
        }
        
        .modal-header h2 {
            margin: 0;
            color: var(--verizon-red);
            font-size: 1.5em;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }
        
        .close-btn:hover {
            color: var(--verizon-red);
        }
        
        .modal-image {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .image-gallery {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .image-gallery img {
            width: 45%;
            min-width: 200px;
            height: auto;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: transform 0.2s ease;
        }
        
        .image-gallery img:hover {
            transform: scale(1.05);
            border-color: var(--verizon-red);
        }
        
        .led-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .led-section {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 4px solid var(--verizon-red);
            background-color: white;
        }
        
        .led-section h4 {
            margin: 0 0 8px 0;
            color: var(--verizon-red);
        }
        
        .led-status {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 0.9em;
        }
        
        .led-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .led-yellow { background-color: #ffd700; }
        .led-white { background-color: #ffffff; border-color: #333; }
        .led-unlit { background-color: #666; }
        
        /* Enhanced Hotspot Styles */
        .hotspot {
            background: var(--verizon-red);
            border: 3px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            position: relative;
            pointer-events: auto !important;
            z-index: 100;
        }
        
        .hotspot:hover {
            transform: scale(1.2);
            background: #a8030a;
        }
        
        .hotspot .annotation {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .hotspot:hover .annotation {
            opacity: 1;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(205, 4, 11, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(205, 4, 11, 0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        @media (max-width: 768px) {
            .modal-content {
                max-width: 95%;
                padding: 15px;
            }
            
            .image-gallery img {
                width: 100%;
            }
        }
        
        /* AR Controls Styles */
        #ar-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
        }
        
        .ar-controls-panel {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .ar-control-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .ar-control-item label {
            font-size: 14px;
            font-weight: 600;
            min-width: 100px;
        }
        
        #ar-scale-slider {
            flex: 1;
            height: 6px;
            background: #333;
            border-radius: 3px;
            outline: none;
        }
        
        #ar-scale-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--verizon-red);
            border-radius: 50%;
            cursor: pointer;
        }
        
        #scale-display {
            font-weight: bold;
            min-width: 50px;
            text-align: center;
            background: var(--verizon-red);
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
        }
        
        .ar-control-buttons {
            display: flex;
            gap: 10px;
        }
        
        .ar-control-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #ar-reset-btn {
            background: #666;
            color: white;
        }
        
        #ar-reset-btn:hover {
            background: #777;
        }
        
        #ar-done-btn {
            background: var(--verizon-red);
            color: white;
        }
        
        #ar-done-btn:hover {
            background: #a8030a;
        }
        
        /* AR Hint Overlay */
        #ar-hint {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ar-hint-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .ar-hint-content h3 {
            color: var(--verizon-red);
            margin-bottom: 15px;
        }
        
        .ar-hint-content ul {
            text-align: left;
            margin: 15px 0;
            padding-left: 20px;
            line-height: 1.5;
        }
        
        .ar-hint-button {
            background: var(--verizon-red);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .ar-hint-button:hover {
            background: #a8030a;
        }
        
        /* AR Simulation Controls for Development */
        #ar-simulator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2500;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--verizon-red);
            max-width: 300px;
        }
        
        .ar-simulator-panel h4 {
            margin: 0 0 10px 0;
            color: var(--verizon-red);
            font-size: 14px;
        }
        
        .simulator-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .simulator-controls button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: var(--verizon-red);
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .simulator-controls button:hover {
            background: #a8030a;
        }
        
        .simulator-controls button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .simulator-info {
            font-size: 12px;
            line-height: 1.4;
        }
        
        .simulator-info p {
            margin: 5px 0;
        }
        
        .simulator-info span {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .movement-instructions {
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 165, 0, 0.2);
            border-radius: 5px;
            border: 1px solid orange;
        }
        
        .movement-instructions small {
            line-height: 1.3;
        }

        /* --- AR BUTTON FUNCTIONALITY ---
        
        // AR button event listener
        function setupArButton() {
            if (arButton) {
                arButton.addEventListener('click', () => {
                    if (modelViewer.canActivateAR) {
                        console.log('🚀 Activating AR mode');
                        modelViewer.activateAR();
                    } else {
                        console.log('❌ AR not supported on this device');
                        alert('AR is not supported on this device. Please use an AR-capable mobile device with iOS Safari or Android Chrome.');
                    }
                });
            }
        }

        // Initialize all functionality when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setupHotspots();
            setupMenu();
            setupAccessories();
            setupArButton(); // <-- Add this line to initialize AR button functionality
            console.log('🚀 All interactive features initialized');
        });
        
        /* --- BUYING EXPERIENCE STYLES --- */
        
        .buy-router-btn {
            background: linear-gradient(135deg, var(--verizon-red), #e63946);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(205, 4, 11, 0.3);
            margin: 20px 0;
            width: 100%;
        }
        
        .buy-router-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(205, 4, 11, 0.4);
        }
        
        .buy-router-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .view-cart-btn {
            background: linear-gradient(135deg, #333, #555);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
            width: 100%;
        }
        
        .view-cart-btn:hover {
            background: linear-gradient(135deg, #555, #777);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }
        
        #cart-count {
            background: var(--verizon-red);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.9em;
            min-width: 18px;
            display: inline-block;
            text-align: center;
        }
        
        /* Plan Selection Modal */
        .plan-selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            display: none;
            overflow-y: auto;
        }
        
        .plan-selection-content {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            position: relative;
        }
        
        .plan-selection-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .plan-selection-header h2 {
            color: var(--verizon-red);
            font-size: 2em;
            margin: 0;
        }
        
        .plan-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .plan-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
        }
        
        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--verizon-red);
        }
        
        .plan-card.selected {
            border-color: var(--verizon-red);
            background: linear-gradient(135deg, #fff5f5, #fff);
            box-shadow: 0 8px 20px rgba(205, 4, 11, 0.2);
        }
        
        .plan-card.popular {
            border-color: #ff6b35;
            position: relative;
        }
        
        .plan-card.popular::before {
            content: "MOST POPULAR";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff6b35;
            color: white;
            padding: 5px 20px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .plan-speed {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--verizon-red);
            margin: 10px 0;
        }
        
        .plan-price {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--verizon-dark-grey);
            margin: 15px 0;
        }
        
        .plan-features {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        
        .plan-features li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .plan-features li:last-child {
            border-bottom: none;
        }
        
        /* Accessory Selection */
        .accessory-selection {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }
        
        .accessory-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .accessory-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .accessory-card:hover {
            border-color: var(--verizon-red);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .accessory-card.selected {
            border-color: var(--verizon-red);
            background: #fff5f5;
        }
        
        .accessory-card h4 {
            margin: 0 0 10px 0;
            color: var(--verizon-dark-grey);
        }
        
        .accessory-card .price {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--verizon-red);
            margin: 10px 0;
        }
        
        /* Purchase Summary */
        .purchase-summary {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .summary-total {
            border-top: 2px solid var(--verizon-red);
            padding-top: 15px;
            margin-top: 15px;
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .complete-purchase-btn {
            background: var(--verizon-red);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .complete-purchase-btn:hover {
            background: #a8030a;
            transform: translateY(-2px);
        }
        
        /* Post-Purchase Interactive Hotspots */
        .post-purchase-hotspot {
            background: #28a745;
            border: 3px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse-green 2s infinite;
            position: relative;
            pointer-events: auto !important;
            z-index: 100;
        }
        
        .post-purchase-hotspot:hover {
            transform: scale(1.3);
            background: #1e7e34;
        }
        
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(40, 167, 69, 0); }
        }
        
        /* Purchase Success */
        .purchase-success {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 4em;
            color: #28a745;
            margin-bottom: 20px;
        }
        
        .purchase-success h3 {
            color: #28a745;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .modal-content {
                max-width: 95%;
                padding: 15px;
            }
            
            .image-gallery img {
                width: 100%;
            }
            
            .plan-cards {
                grid-template-columns: 1fr;
            }
            
            .plan-selection-content {
                margin: 10px;
                padding: 20px;
            }
        }
        
        /* Floating Action Buttons */
        .floating-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }
        
        .floating-btn {
            background: var(--verizon-red);
            color: var(--verizon-white);
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(205, 4, 11, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
            justify-content: center;
        }
        
        .floating-btn:hover {
            background: var(--verizon-dark-red);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(205, 4, 11, 0.6);
        }
        
        .floating-btn.secondary {
            background: var(--verizon-black);
            color: var(--verizon-white);
            border: 2px solid var(--verizon-red);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .floating-btn.secondary:hover {
            background: var(--verizon-dark-grey);
            border-color: var(--verizon-dark-red);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }
        
        .floating-btn .icon {
            font-size: 18px;
        }
        
        /* Pulse animation for highlighting */
        @keyframes pulse {
            0%, 100% { 
                transform: translateY(0) scale(1);
                box-shadow: 0 4px 20px rgba(205, 4, 11, 0.4);
            }
            50% { 
                transform: translateY(-2px) scale(1.05);
                box-shadow: 0 8px 30px rgba(205, 4, 11, 0.8);
            }
        }
        
        /* Mobile responsive for floating buttons */
        @media (max-width: 768px) {
            .floating-buttons {
                bottom: 20px;
                right: 20px;
                left: 20px;
                flex-direction: column;
                gap: 10px;
            }
            
            .floating-btn {
                min-width: auto;
                width: 100%;
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        Verizon <span>AR</span> Experience - FiOS Router
    </div>

    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menu-toggle">☰</button>

    <!-- Side Menu -->
    <div class="side-menu" id="side-menu">
        <div class="menu-content">
            <!-- Product Information Panel -->
            <div class="product-info" id="product-info">
                <h3 id="product-name">Verizon FiOS Router</h3>
                <p id="product-description">Ultra-fast FiOS home internet router with Wi-Fi 6E technology</p>
                <div class="price" id="product-price">$399.99</div>
                
                <!-- Compatible Accessories -->
                <div class="accessories-section" id="accessories-section">
                    <h4>Compatible Accessories</h4>
                    <div class="accessories-list" id="accessories-list">
                        <div class="accessory-item">
                            <div class="accessory-header">
                                <span class="accessory-name">Wall Mounting Bracket</span>
                                <span class="accessory-price">$24.99</span>
                            </div>
                            <div class="accessory-description">Secure wall mount for optimal router placement and better signal coverage</div>
                            <button class="add-accessory-btn" data-accessory="Wall Mounting Bracket">Add to Cart</button>
                        </div>
                        <div class="accessory-item">
                            <div class="accessory-header">
                                <span class="accessory-name">Ethernet Cable (25ft)</span>
                                <span class="accessory-price">$19.99</span>
                            </div>
                            <div class="accessory-description">High-speed Cat6 ethernet cable for direct wired connections</div>
                            <button class="add-accessory-btn" data-accessory="Ethernet Cable">Add to Cart</button>
                        </div>
                        <div class="accessory-item">
                            <div class="accessory-header">
                                <span class="accessory-name">Range Extender</span>
                                <span class="accessory-price">$89.99</span>
                            </div>
                            <div class="accessory-description">Extend Wi-Fi coverage to eliminate dead zones in your home</div>
                            <button class="add-accessory-btn" data-accessory="Range Extender">Add to Cart</button>
                        </div>
                    </div>
                </div>
                
                <!-- Buy Router Section -->
                <div class="buy-section" id="buy-section">
                    <button class="buy-router-btn" id="buy-router-btn">
                        🛒 Buy Router + Choose Plan
                    </button>
                    <button class="view-cart-btn" id="view-cart-btn" onclick="openCartPage()">
                        🛍️ View Cart (<span id="cart-count">0</span>)
                    </button>
                    <p style="font-size: 0.9em; color: #666; text-align: center; margin-top: 10px;">
                        Bundle with internet plan for best pricing
                    </p>
                </div>
            </div>
            
            <!-- AR Section -->
            <div class="ar-section">
                <!-- AR Features -->
                <div class="ar-features">
                    <button class="feature-btn" id="info-btn">ℹ️ Info</button>
                    <button class="feature-btn" id="camera-scanner-btn" onclick="openCameraScanner()">📱 Scan Your Router</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Fixed AR Button in right corner -->
        <button id="ar-button">🏠 Try in Your Room</button>
        
        <!-- This container holds the 3D model viewer -->
        <div id="viewer-container">
        <model-viewer
            id="product-viewer"
            src="./final_router.glb"
            ios-src="./final_router.glb"
            alt="A 3D model of a Verizon 5G Router"
            ar
            ar-modes="webxr scene-viewer quick-look"
            ar-placement="floor wall"
            ar-scale="fixed"
            camera-controls
            camera-orbit="45deg 75deg 5m"
            min-camera-orbit="auto auto 2m"
            max-camera-orbit="auto auto 10m"
            field-of-view="35deg"
            shadow-intensity="1"
            shadow-softness="0.5"
            environment-image="neutral"
            exposure="1"
            autoplay
            interaction-prompt="auto"
            touch-action="pan-y">
            
            <!-- Hotspots for interactive features -->
            <button class="hotspot" slot="hotspot-1" data-position="1 1 1" data-normal="0 1 0" id="wifi-hotspot">
                <div class="annotation">Wi-Fi 6E</div>
            </button>
            
            <button class="hotspot" slot="hotspot-2" data-position="-1 0.5 -1" data-normal="0 0 -1" id="rear-hotspot">
                <div class="annotation">Rear Panel</div>
            </button>
            
            <button class="hotspot" slot="hotspot-3" data-position="0.5 0.2 1" data-normal="0 0 1" id="led-hotspot">
                <div class="annotation">LED Status</div>
            </button>
            
            <button class="hotspot" slot="hotspot-4" data-position="0 -0.8 0" data-normal="0 -1 0" id="mount-hotspot">
                <div class="annotation">Mounting</div>
            </button>
        </model-viewer>
        </div>
        
        <!-- AR Controls - Only visible during AR session -->
        <div id="ar-controls" style="display: none;">
            <div class="ar-controls-panel">
                <div class="ar-control-item">
                    <label>Position Scale:</label>
                    <input type="range" id="ar-scale-slider" min="0.5" max="2" step="0.1" value="1">
                    <span id="scale-display">1.0x</span>
                </div>
                <div class="ar-control-buttons">
                    <button id="ar-reset-btn">Reset Position</button>
                    <button id="ar-done-btn">Done</button>
                </div>
            </div>
        </div>
        
        <!-- AR Placement Hint -->
        <div id="ar-hint" style="display: none;">
            <div class="ar-hint-content">
                <h3>🎯 Place Your Router in AR</h3>
                <p>Point your camera at a flat surface and tap to place the router at real-world scale.</p>
                <ul>
                    <li>Tap anywhere to place the router</li>
                    <li>Drag with one finger to move</li>
                    <li>Pinch with two fingers to resize</li>
                    <li>Use the controls for precise adjustments</li>
                </ul>
                <button class="ar-hint-button" onclick="hideArHint()">Got It! Start Placing</button>
            </div>
        </div>
        
        <!-- AR Simulator Controls for Development -->
        <!--<div id="ar-simulator" style="display: none;">
            <div class="ar-simulator-panel">
                <h4>🧪 AR Simulator (Development Mode)</h4>
                <div class="simulator-controls">
                    <button id="simulate-ar-btn">Simulate AR Session</button>
                    <button id="simulate-placement-btn">Simulate Placement</button>
                    <button id="stop-simulation-btn">Stop Simulation</button>
                    <button id="enable-movement-btn" style="display:none;">Enable Movement Mode</button>
                    <button id="reset-position-btn" style="display:none;">Reset Position</button>
                </div>
                <div class="simulator-info">
                    <p>Status: <span id="sim-status">Ready</span></p>
                    <p>Scale: <span id="sim-scale">1.0x</span></p>
                    <p>Mode: <span id="sim-mode">Rotation</span></p>
                </div>
                <div class="movement-instructions" id="movement-instructions" style="display:none;">
                    <small>
                        <strong>Movement Mode Active:</strong><br>
                        • Drag mouse = Move router position<br>
                        • Mouse wheel = Scale router size<br>
                        • Right click = Exit movement mode<br>
                        • Reset button = Return to center
                    </small>
                </div>
            </div>
        </div>-->
        
        <!-- Interactive Feature Modals -->
        
        <!-- Rear Panel Modal -->
        <div id="rear-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>🔌 Rear Panel Information</h2>
                    <button class="close-btn" onclick="closeModal('rear-modal')">&times;</button>
                </div>
                <img src="./back router info.png" alt="Router Rear Panel Information" class="modal-image">
                <p>Complete overview of all rear panel ports and connections for your Verizon FiOS Router.</p>
            </div>
        </div>
        
        <!-- LED Status Modal -->
        <div id="led-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>💡 LED Status Indicators</h2>
                    <button class="close-btn" onclick="closeModal('led-modal')">&times;</button>
                </div>
                <div class="led-info">
                    <div class="led-section">
                        <h4>LAN/WAN Ethernet Port</h4>
                        <div class="led-status">
                            <div class="led-indicator led-unlit"></div>
                            <span><strong>Unlit</strong> – Indicates no Ethernet link or dims after 5 minutes idle</span>
                        </div>
                    </div>
                    
                    <div class="led-section">
                        <h4>Left LED</h4>
                        <div class="led-status">
                            <div class="led-indicator led-yellow"></div>
                            <span><strong>Solid yellow</strong> – Indicates less than 1 Gbps link</span>
                        </div>
                        <div class="led-status">
                            <div class="led-indicator led-yellow" style="animation: blink 1s infinite;"></div>
                            <span><strong>Flash yellow</strong> – Indicates LAN/WAN activity. The traffic can be in either direction.</span>
                        </div>
                    </div>
                    
                    <div class="led-section">
                        <h4>Right LED</h4>
                        <div class="led-status">
                            <div class="led-indicator led-white"></div>
                            <span><strong>Solid white</strong> – Indicates 1/2.5/5/10 Gbps link</span>
                        </div>
                        <div class="led-status">
                            <div class="led-indicator led-white" style="animation: blink 1s infinite;"></div>
                            <span><strong>Flash white</strong> – Indicates LAN/WAN activity. The traffic can be in either direction.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mounting Modal -->
        <div id="mount-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>🔧 Mounting Options</h2>
                    <button class="close-btn" onclick="closeModal('mount-modal')">&times;</button>
                </div>
                <div class="image-gallery">
                    <img src="./mount1.png" alt="Mounting Option 1" class="modal-image">
                    <img src="./mount2.png" alt="Mounting Option 2" class="modal-image">
                </div>
                <p>Choose from multiple mounting configurations to best suit your installation needs.</p>
            </div>
        </div>
        
        <!-- Plan Selection Modal -->
        <div id="plan-selection-modal" class="plan-selection-modal">
            <div class="plan-selection-content">
                <div class="plan-selection-header">
                    <h2>🚀 Choose Your Verizon FiOS Plan</h2>
                    <button class="close-btn" onclick="closePlanModal()">&times;</button>
                    <p>Select the perfect internet plan to go with your new router</p>
                </div>
                
                <!-- Plan Cards -->
                <div class="plan-cards">
                    <div class="plan-card" data-plan="basic" data-price="39.99">
                        <h3>Basic FiOS</h3>
                        <div class="plan-speed">200 Mbps</div>
                        <div class="plan-price">$39.99/mo</div>
                        <ul class="plan-features">
                            <li>✓ Perfect for 1-2 devices</li>
                            <li>✓ Stream HD video</li>
                            <li>✓ Basic web browsing</li>
                            <li>✓ Email and social media</li>
                        </ul>
                    </div>
                    
                    <div class="plan-card popular" data-plan="gigabit" data-price="64.99">
                        <h3>Gigabit FiOS</h3>
                        <div class="plan-speed">1000 Mbps</div>
                        <div class="plan-price">$64.99/mo</div>
                        <ul class="plan-features">
                            <li>✓ Perfect for 4-6 devices</li>
                            <li>✓ Stream 4K ultra HD</li>
                            <li>✓ Gaming and video calls</li>
                            <li>✓ Smart home devices</li>
                            <li>✓ Work from home</li>
                        </ul>
                    </div>
                    
                    <div class="plan-card" data-plan="ultra" data-price="89.99">
                        <h3>Ultra FiOS</h3>
                        <div class="plan-speed">2000 Mbps</div>
                        <div class="plan-price">$89.99/mo</div>
                        <ul class="plan-features">
                            <li>✓ Perfect for 8+ devices</li>
                            <li>✓ Multiple 4K streams</li>
                            <li>✓ Professional gaming</li>
                            <li>✓ Large file uploads</li>
                            <li>✓ Future-proof speed</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Accessory Selection -->
                <div class="accessory-selection">
                    <h3>📦 Add Premium Accessories</h3>
                    <div class="accessory-cards">
                        <div class="accessory-card" data-accessory="mesh" data-price="149.99">
                            <h4>🌐 Mesh Network Extender</h4>
                            <p>Eliminate dead zones with Wi-Fi 6E mesh technology</p>
                            <div class="price">$149.99</div>
                        </div>
                        
                        <div class="accessory-card" data-accessory="security" data-price="9.99">
                            <h4>🔒 Advanced Security Package</h4>
                            <p>24/7 network protection and parental controls</p>
                            <div class="price">$9.99/mo</div>
                        </div>
                        
                        <div class="accessory-card" data-accessory="support" data-price="14.99">
                            <h4>🛠️ Premium Tech Support</h4>
                            <p>Priority support and installation assistance</p>
                            <div class="price">$14.99/mo</div>
                        </div>
                        
                        <div class="accessory-card" data-accessory="cloud" data-price="12.99">
                            <h4>☁️ Cloud Storage Plus</h4>
                            <p>1TB secure cloud backup for all your devices</p>
                            <div class="price">$12.99/mo</div>
                        </div>
                    </div>
                </div>
                
                <!-- Purchase Summary -->
                <div class="purchase-summary">
                    <h3>📋 Order Summary</h3>
                    <div class="summary-item">
                        <span>Verizon FiOS Router:</span>
                        <span>$399.99</span>
                    </div>
                    <div class="summary-item" id="selected-plan">
                        <span>Internet Plan:</span>
                        <span>Select a plan</span>
                    </div>
                    <div id="selected-accessories"></div>
                    <div class="summary-total">
                        <div class="summary-item">
                            <span>Total Monthly:</span>
                            <span id="monthly-total">$0.00/mo</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Today:</span>
                            <span id="today-total">$399.99</span>
                        </div>
                    </div>
                    
                    <button class="complete-purchase-btn" id="complete-purchase-btn" disabled>
                        Complete Purchase
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Purchase Success Modal -->
        <div id="purchase-success-modal" class="plan-selection-modal">
            <div class="plan-selection-content">
                <div class="purchase-success">
                    <div class="success-icon">🎉</div>
                    <h3>Purchase Successful!</h3>
                    <p>Your Verizon FiOS Router and plan have been ordered.</p>
                    <p><strong>Installation scheduled:</strong> Within 3-5 business days</p>
                    <p>You'll receive a confirmation email shortly.</p>
                    <p><em>Notice: New interactive features are now available on your 3D model!</em></p>
                    <button class="complete-purchase-btn" onclick="completePurchaseFlow()">
                        Explore Your New Router
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simplified product data - 3 core Verizon products with fallback models
        const products = {
            Router: {
                src: './final_router.glb',
                iosSrc: './final_router.glb',
                alt: 'A 3D model of a Verizon FiOS Router',
                name: 'Verizon FiOS Router',
                description: 'Ultra-fast FiOS home internet router with Wi-Fi 6E technology',
                price: '$399.99',
                accessories: [
                    { name: 'Wall Mounting Bracket', price: '$24.99', compatible: true },
                    { name: 'Ethernet Cable (25ft)', price: '$19.99', compatible: true },
                    { name: 'Range Extender', price: '$89.99', compatible: true }
                ]
            },
            TV: {
                src: 'https://modelviewer.dev/shared-assets/models/RobotExpressive.glb',
                iosSrc: 'https://modelviewer.dev/shared-assets/models/RobotExpressive.usdz',
                alt: 'A 3D model of a Verizon Stream TV Box',
                name: 'Verizon Stream TV Pro',
                description: '4K streaming device with voice remote and premium apps',
                price: '$69.99'
            },
            Phone: {
                src: 'https://modelviewer.dev/shared-assets/models/Astronaut.glb',
                iosSrc: 'https://modelviewer.dev/shared-assets/models/Astronaut.usdz',
                alt: 'A 3D model of iPhone 15 Pro',
                name: 'iPhone 15 Pro',
                description: 'Latest iPhone with titanium design, A17 Pro chip, and advanced camera system',
                price: '$999.99'
            }
        };

        // --- DOM ELEMENT REFERENCES ---
        const modelViewer = document.querySelector('#product-viewer');
        const arButton = document.querySelector('#ar-button');
        const infoBtn = document.querySelector('#info-btn');
        const menuToggle = document.querySelector('#menu-toggle');
        const sideMenu = document.querySelector('#side-menu');
        const productName = document.querySelector('#product-name');
        const productDescription = document.querySelector('#product-description');
        const productPrice = document.querySelector('#product-price');

        // AR Controls DOM references
        const arControls = document.querySelector('#ar-controls');
        const arHint = document.querySelector('#ar-hint');
        const arScaleSlider = document.querySelector('#ar-scale-slider');
        const scaleDisplay = document.querySelector('#scale-display');
        const arResetBtn = document.querySelector('#ar-reset-btn');
        const arDoneBtn = document.querySelector('#ar-done-btn');

        // AR Simulator DOM references  
        const arSimulator = document.querySelector('#ar-simulator');
        const simulateArBtn = document.querySelector('#simulate-ar-btn');
        const simulatePlacementBtn = document.querySelector('#simulate-placement-btn');
        const stopSimulationBtn = document.querySelector('#stop-simulation-btn');
        const enableMovementBtn = document.querySelector('#enable-movement-btn');
        const resetPositionBtn = document.querySelector('#reset-position-btn');
        const simStatus = document.querySelector('#sim-status');
        const simScale = document.querySelector('#sim-scale');
        const simMode = document.querySelector('#sim-mode');
        const movementInstructions = document.querySelector('#movement-instructions');

        // AR state variables
        let isInAR = false;
        let realWorldScale = 1.0;
        let viewerScale = 1.0;
        let isSimulating = false;
        let movementMode = false;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let routerPosition = { x: 0, y: 0, z: 0 };

        // --- AR FUNCTIONALITY ---
        
        // Show AR hint when entering AR
        function showArHint() {
            if (arHint) {
                arHint.style.display = 'flex';
            }
        }

        // Hide AR hint
        function hideArHint() {
            if (arHint) {
                arHint.style.display = 'none';
            }
        }

        // Update model scale
        function updateModelScale(scale, isArMode = false) {
            if (isArMode) {
                realWorldScale = scale;
                // In AR mode, use the real-world scale
                modelViewer.scale = `${scale} ${scale} ${scale}`;
            } else {
                viewerScale = scale;
                // In 3D viewer mode, use the viewer scale
                modelViewer.scale = `${scale} ${scale} ${scale}`;
            }
        }

        // Update scale display
        function updateScaleDisplay(scale) {
            if (scaleDisplay) {
                scaleDisplay.textContent = `${scale.toFixed(1)}x`;
            }
        }

        // Reset AR placement
        function resetArPlacement() {
            realWorldScale = 1.0;
            updateModelScale(1.0, true);
            updateScaleDisplay(1.0);
            if (arScaleSlider) {
                arScaleSlider.value = 1.0;
            }
        }

        // Reset router position
        function resetRouterPosition() {
            routerPosition = { x: 0, y: 0, z: 0 };
            
            // Reset model position
            try {
                modelViewer.cameraTarget = '0m 0m 0m';
                // Also clear any CSS transforms
                modelViewer.style.transform = '';
            } catch (e) {
                // Fallback: clear CSS transform
                modelViewer.style.transform = '';
            }
            
            // Reset all hotspots to their original positions
            const hotspots = modelViewer.querySelectorAll('.hotspot');
            hotspots.forEach(hotspot => {
                if (hotspot.dataset.originalPosition) {
                    hotspot.setAttribute('data-position', hotspot.dataset.originalPosition);
                }
            });
            
            console.log('📍 Router position reset to origin');
        }

        // AR session event listeners
        modelViewer.addEventListener('ar-status', (event) => {
            if (event.detail.status === 'session-started') {
                console.log('🚀 AR session started');
                isInAR = true;
                
                // Show AR controls and hint
                if (arControls) arControls.style.display = 'block';
                showArHint();
                
                // Switch to real-world scale
                updateModelScale(realWorldScale, true);
                updateScaleDisplay(realWorldScale);
                
            } else if (event.detail.status === 'not-presenting') {
                console.log('🔚 AR session ended');
                isInAR = false;
                
                // Hide AR controls and hint
                if (arControls) arControls.style.display = 'none';
                hideArHint();
                
                // Switch back to viewer scale
                updateModelScale(viewerScale, false);
                updateScaleDisplay(viewerScale);
            }
        });

        // AR Controls event listeners
        if (arScaleSlider) {
            arScaleSlider.addEventListener('input', (e) => {
                const scale = parseFloat(e.target.value);
                updateModelScale(scale, isInAR);
                updateScaleDisplay(scale);
            });
        }

        if (arResetBtn) {
            arResetBtn.addEventListener('click', resetArPlacement);
        }

        if (arDoneBtn) {
            arDoneBtn.addEventListener('click', () => {
                hideArHint();
            });
        }

        // Make hideArHint globally accessible
        window.hideArHint = hideArHint;

        // --- AR SIMULATOR FOR DEVELOPMENT ---
        
        // Show AR simulator in development (localhost)
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            if (arSimulator) {
                arSimulator.style.display = 'block';
                console.log('🧪 AR Simulator enabled for local development');
            }
        }
        
        // Simulate AR session start
        function simulateArSession() {
            if (isSimulating) return;
            
            // Reset any previous movement mode state
            if (movementMode) {
                disableMovementMode();
            }
            
            isSimulating = true;
            isInAR = true;
            
            // Update UI
            if (simStatus) simStatus.textContent = 'AR Session Active';
            if (simulateArBtn) simulateArBtn.disabled = true;
            if (stopSimulationBtn) stopSimulationBtn.disabled = false;
            if (enableMovementBtn) {
                enableMovementBtn.style.display = 'block';
                // Ensure proper event listener setup
                enableMovementBtn.removeEventListener('click', enableMovementMode);
                enableMovementBtn.removeEventListener('click', disableMovementMode);
                enableMovementBtn.addEventListener('click', enableMovementMode);
                enableMovementBtn.textContent = 'Enable Movement Mode';
            }
            if (resetPositionBtn) resetPositionBtn.style.display = 'block';
            
            // Show AR controls and hint (like real AR)
            if (arControls) arControls.style.display = 'block';
            showArHint();
            
            // Switch to real-world scale
            updateModelScale(realWorldScale, true);
            updateScaleDisplay(realWorldScale);
            
            // Add visual indicator that we're in simulation mode
            document.body.style.border = '4px solid orange';
            document.body.style.boxSizing = 'border-box';
            
            console.log('🧪 Simulating AR session started');
        }
        
        // Enable movement mode
        function enableMovementMode() {
            if (movementMode) return; // Already in movement mode
            
            movementMode = true;
            if (simMode) simMode.textContent = 'Movement';
            if (movementInstructions) movementInstructions.style.display = 'block';
            if (enableMovementBtn) {
                enableMovementBtn.textContent = 'Disable Movement Mode';
                enableMovementBtn.style.display = 'block';
                // Remove existing event listener to avoid duplicates
                enableMovementBtn.removeEventListener('click', enableMovementMode);
                enableMovementBtn.removeEventListener('click', disableMovementMode);
                enableMovementBtn.addEventListener('click', disableMovementMode);
            }
            
            // Disable camera controls in model-viewer
            modelViewer.cameraControls = false;
            
            // Remove any existing event listeners first to prevent duplicates
            cleanupMovementListeners();
            
            // Add movement event listeners
            modelViewer.addEventListener('mousedown', startDrag);
            modelViewer.addEventListener('mousemove', drag);
            modelViewer.addEventListener('mouseup', stopDrag);
            modelViewer.addEventListener('wheel', handleWheel);
            modelViewer.addEventListener('contextmenu', toggleRotation);
            
            console.log('🖱️ Movement mode enabled');
        }
        
        // Disable movement mode
        function disableMovementMode() {
            if (!movementMode) return; // Already disabled
            
            movementMode = false;
            isDragging = false; // Reset dragging state
            
            if (simMode) simMode.textContent = 'Rotation';
            if (movementInstructions) movementInstructions.style.display = 'none';
            if (enableMovementBtn) {
                enableMovementBtn.textContent = 'Enable Movement Mode';
                enableMovementBtn.style.display = 'block';
                // Remove existing event listener to avoid duplicates
                enableMovementBtn.removeEventListener('click', enableMovementMode);
                enableMovementBtn.removeEventListener('click', disableMovementMode);
                enableMovementBtn.addEventListener('click', enableMovementMode);
            }
            
            // Re-enable camera controls
            modelViewer.cameraControls = true;
            
            // Remove movement event listeners
            cleanupMovementListeners();
            
            console.log('🔄 Rotation mode enabled');
        }
        
        // Clean up movement event listeners
        function cleanupMovementListeners() {
            modelViewer.removeEventListener('mousedown', startDrag);
            modelViewer.removeEventListener('mousemove', drag);
            modelViewer.removeEventListener('mouseup', stopDrag);
            modelViewer.removeEventListener('wheel', handleWheel);
            modelViewer.removeEventListener('contextmenu', toggleRotation);
        }
        
        // Mouse drag functions for movement
        function startDrag(event) {
            if (!movementMode) return;
            isDragging = true;
            lastMouseX = event.clientX;
            lastMouseY = event.clientY;
            event.preventDefault();
        }
        
        function drag(event) {
            if (!movementMode || !isDragging) return;
            
            const deltaX = (event.clientX - lastMouseX) * 0.01;
            const deltaY = (event.clientY - lastMouseY) * 0.01;
            
            routerPosition.x += deltaX;
            routerPosition.y -= deltaY; // Invert Y for natural movement
            
            // Update model position
            updateModelPosition();
            
            lastMouseX = event.clientX;
            lastMouseY = event.clientY;
            event.preventDefault();
        }
        
        function stopDrag(event) {
            if (!movementMode) return;
            isDragging = false;
            event.preventDefault();
        }
        
        // Handle mouse wheel for scaling
        function handleWheel(event) {
            if (!movementMode || !isSimulating) return;
            
            const delta = event.deltaY > 0 ? -0.1 : 0.1;
            const newScale = Math.max(0.5, Math.min(2, realWorldScale + delta));
            
            updateModelScale(newScale, true);
            updateScaleDisplay(newScale);
            
            if (arScaleSlider) arScaleSlider.value = newScale;
            if (simScale) simScale.textContent = `${newScale.toFixed(1)}x`;
            
            event.preventDefault();
            event.stopPropagation();
            
            console.log(`🔄 Wheel scaling: ${newScale.toFixed(1)}x`);
        }
        
        // Toggle rotation mode
        function toggleRotation(event) {
            if (!movementMode) return;
            event.preventDefault();
            disableMovementMode();
        }
        
        // Update model position
        function updateModelPosition() {
            const position = `${routerPosition.x} ${routerPosition.y} ${routerPosition.z}`;
            
            // Instead of moving the camera target (which changes view), 
            // we'll adjust the camera orbit to simulate model movement
            const currentOrbit = modelViewer.getCameraOrbit();
            modelViewer.cameraOrbit = `${currentOrbit.theta}rad ${currentOrbit.phi}rad ${currentOrbit.radius}m`;
            
            // For AR simulation, we can use a transform on a wrapper div if needed
            // But for now, let's update the camera target properly
            try {
                // Set camera target with proper units
                modelViewer.cameraTarget = `${routerPosition.x}m ${routerPosition.y}m ${routerPosition.z}m`;
            } catch (e) {
                console.log('Camera target update failed, using alternative method');
                // Fallback: use CSS transform on the model viewer itself (less ideal but functional)
                const transform = `translate3d(${routerPosition.x * 50}px, ${-routerPosition.y * 50}px, 0px)`;
                modelViewer.style.transform = transform;
            }
            
            // Update all hotspots to move with the model
            const hotspots = modelViewer.querySelectorAll('.hotspot');
            hotspots.forEach((hotspot) => {
                // Get original position from a data attribute or use default positions
                let originalPos;
                if (!hotspot.dataset.originalPosition) {
                    // Store original position on first move
                    const currentPosStr = hotspot.getAttribute('data-position');
                    if (currentPosStr) {
                        originalPos = currentPosStr.split(' ').map(Number);
                        hotspot.dataset.originalPosition = originalPos.join(' ');
                    } else {
                        // Default hotspot positions if none set
                        originalPos = [0, 0, 0];
                        hotspot.dataset.originalPosition = originalPos.join(' ');
                    }
                } else {
                    originalPos = hotspot.dataset.originalPosition.split(' ').map(Number);
                }
                
                // Apply router position offset to original hotspot position
                const newPos = [
                    originalPos[0] + routerPosition.x,
                    originalPos[1] + routerPosition.y,
                    originalPos[2] + routerPosition.z
                ];
                hotspot.setAttribute('data-position', newPos.join(' '));
            });
            
            console.log(`📍 Router moved to: ${position}`);
        }
        
        // Simulate object placement
        function simulatePlacement() {
            if (!isSimulating) {
                alert('Start AR simulation first!');
                return;
            }
            
            // Hide the hint as if user placed the object
            hideArHint();
            
            // Add placement animation effect
            modelViewer.style.transform = 'scale(1.1)';
            setTimeout(() => {
                modelViewer.style.transform = 'scale(1.0)';
            }, 200);
            
            if (simStatus) simStatus.textContent = 'Object Placed';
            console.log('🧪 Simulating object placement');
        }
        
        // Stop AR simulation
        function stopArSimulation() {
            if (!isSimulating) return;
            
            isSimulating = false;
            isInAR = false;
            movementMode = false;
            isDragging = false;
            
            // Reset router position
            routerPosition = { x: 0, y: 0, z: 0 };
            
            // Update UI
            if (simStatus) simStatus.textContent = 'Ready';
            if (simMode) simMode.textContent = 'Rotation';
            if (simulateArBtn) simulateArBtn.disabled = false;
            if (stopSimulationBtn) stopSimulationBtn.disabled = true;
            
            // Properly reset movement mode
            if (movementMode) {
                disableMovementMode(); // This will clean up listeners and reset state
            }
            
            if (enableMovementBtn) {
                enableMovementBtn.style.display = 'none';
                enableMovementBtn.textContent = 'Enable Movement Mode';
                // Clean up any existing event listeners
                enableMovementBtn.removeEventListener('click', enableMovementMode);
                enableMovementBtn.removeEventListener('click', disableMovementMode);
                enableMovementBtn.addEventListener('click', enableMovementMode);
            }
            if (resetPositionBtn) resetPositionBtn.style.display = 'none';
            if (movementInstructions) movementInstructions.style.display = 'none';
            
            // Hide AR controls and hint
            if (arControls) arControls.style.display = 'none';
            hideArHint();
            
            // Switch back to viewer scale
            updateModelScale(viewerScale, false);
            
            // Remove visual indicator
            document.body.style.border = '';
            document.body.style.boxSizing = '';
            
            // Reset model viewer
            modelViewer.style.transform = '';
            modelViewer.cameraControls = true;
            
            // Remove any movement event listeners
            modelViewer.removeEventListener('mousedown', startDrag);
            modelViewer.removeEventListener('mousemove', drag);
            modelViewer.removeEventListener('mouseup', stopDrag);
            modelViewer.removeEventListener('wheel', handleWheel);
            modelViewer.removeEventListener('contextmenu', toggleRotation);
            
            console.log('🧪 AR simulation stopped');
        }
        
        // Simulator event listeners
        if (simulateArBtn) {
            simulateArBtn.addEventListener('click', simulateArSession);
        }
        
        if (simulatePlacementBtn) {
            simulatePlacementBtn.addEventListener('click', simulatePlacement);
        }
        
        if (stopSimulationBtn) {
            stopSimulationBtn.addEventListener('click', stopArSimulation);
        }
        
        if (enableMovementBtn) {
            enableMovementBtn.addEventListener('click', enableMovementMode);
        }
        
        if (resetPositionBtn) {
            resetPositionBtn.addEventListener('click', resetRouterPosition);
        }
        
        // Update simulator scale display when scale changes
        if (arScaleSlider) {
            arScaleSlider.addEventListener('input', (e) => {
                const scale = parseFloat(e.target.value);
                updateModelScale(scale, isInAR);
                updateScaleDisplay(scale);
                
                // Update simulator display
                if (simScale) simScale.textContent = `${scale.toFixed(1)}x`;
            });
        }

        // --- HOTSPOT & MODAL FUNCTIONALITY ---
        
        // Modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                console.log(`📋 Opened modal: ${modalId}`);
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                console.log(`❌ Closed modal: ${modalId}`);
            }
        }
        
        // Info modal functions for post-purchase hotspots
        function showInfoModal(content) {
            // Create or get existing info modal
            let infoModal = document.getElementById('info-modal');
            if (!infoModal) {
                infoModal = document.createElement('div');
                infoModal.id = 'info-modal';
                infoModal.className = 'modal';
                infoModal.innerHTML = `
                    <div class="modal-content">
                        <div id="info-modal-body"></div>
                    </div>
                `;
                document.body.appendChild(infoModal);
            }
            
            document.getElementById('info-modal-body').innerHTML = content;
            infoModal.style.display = 'block';
        }
        
        function closeInfoModal() {
            const infoModal = document.getElementById('info-modal');
            if (infoModal) {
                infoModal.style.display = 'none';
            }
        }
        
        // Make functions globally accessible
        window.closeInfoModal = closeInfoModal;
        window.showInfoModal = showInfoModal;
        
        // Close modal when clicking outside of it
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });
        
        // Hotspot event listeners
        function setupHotspots() {
            console.log('🔍 Setting up hotspots...');
            
            // Wi-Fi 6E hotspot (currently no specific modal, could show info)
            const wifiHotspot = document.getElementById('wifi-hotspot');
            if (wifiHotspot) {
                console.log('✅ Found wifi-hotspot element');
                wifiHotspot.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('📶 Wi-Fi 6E info clicked');
                    // Could open a Wi-Fi info modal in the future
                    alert('Wi-Fi 6E Technology\n\nThis router features the latest Wi-Fi 6E technology for ultra-fast wireless connections with reduced interference.');
                });
            } else {
                console.log('❌ wifi-hotspot element not found');
            }
            
            // Rear panel hotspot
            const rearHotspot = document.getElementById('rear-hotspot');
            if (rearHotspot) {
                console.log('✅ Found rear-hotspot element');
                rearHotspot.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('🔌 Rear panel clicked');
                    openModal('rear-modal');
                });
            } else {
                console.log('❌ rear-hotspot element not found');
            }
            
            // LED status hotspot
            const ledHotspot = document.getElementById('led-hotspot');
            if (ledHotspot) {
                console.log('✅ Found led-hotspot element');
                ledHotspot.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('💡 LED status clicked');
                    openModal('led-modal');
                });
            } else {
                console.log('❌ led-hotspot element not found');
            }
            
            // Mounting options hotspot
            const mountHotspot = document.getElementById('mount-hotspot');
            if (mountHotspot) {
                console.log('✅ Found mount-hotspot element');
                mountHotspot.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('🔧 Mount options clicked');
                    openModal('mount-modal');
                });
            } else {
                console.log('❌ mount-hotspot element not found');
            }
            
            console.log('🎯 Hotspots configured and event listeners added');
            
            // Also check if hotspots are visible and clickable
            const allHotspots = document.querySelectorAll('.hotspot');
            console.log(`📍 Found ${allHotspots.length} hotspot elements total`);
            allHotspots.forEach((hotspot, index) => {
                console.log(`   Hotspot ${index + 1}: ID=${hotspot.id}, visible=${getComputedStyle(hotspot).display !== 'none'}`);
                
                // Ensure hotspots are clickable
                hotspot.style.pointerEvents = 'auto';
                hotspot.style.cursor = 'pointer';
                
                // Add a test click handler to all hotspots for debugging
                const existingListener = hotspot.onclick;
                if (!existingListener) {
                    hotspot.addEventListener('click', (e) => {
                        console.log(`🎯 Hotspot clicked: ${hotspot.id}`);
                    });
                }
            });
        }
        
        // Make closeModal globally accessible for onclick handlers
        window.closeModal = closeModal;
        
        // Initialize hotspots when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('📄 DOM Content Loaded - setting up hotspots');
            setupHotspots();
        });
        
        // Also setup hotspots after model loads (in case DOMContentLoaded already fired)
        modelViewer.addEventListener('load', () => {
            console.log('🎮 Model viewer loaded - setting up hotspots');
            setupHotspots();
        });
        
        // Additional safety - setup hotspots after a short delay
        setTimeout(() => {
            console.log('⏰ Timeout setup - ensuring hotspots are configured');
            setupHotspots();
        }, 2000);

        // --- MENU FUNCTIONALITY ---
        
        // Menu toggle functionality
        function setupMenu() {
            if (menuToggle && sideMenu) {
                menuToggle.addEventListener('click', () => {
                    sideMenu.classList.toggle('open');
                    console.log('🍔 Menu toggled');
                });
            }
            
            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                if (sideMenu && sideMenu.classList.contains('open')) {
                    if (!sideMenu.contains(event.target) && !menuToggle.contains(event.target)) {
                        sideMenu.classList.remove('open');
                    }
                }
            });
        }
        
        // --- ACCESSORY FUNCTIONALITY ---
        
        // Accessory button functionality
        function setupAccessories() {
            const accessoryButtons = document.querySelectorAll('.add-accessory-btn');
            accessoryButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const accessoryName = button.getAttribute('data-accessory');
                    
                    if (button.classList.contains('added')) {
                        // Remove from cart
                        button.classList.remove('added');
                        button.textContent = 'Add to Cart';
                        removeFromStoredCart(accessoryName);
                        console.log(`🛒 Removed ${accessoryName} from cart`);
                    } else {
                        // Add to cart and redirect to cart page
                        addToStoredCart(accessoryName);
                        console.log(`🛒 Added ${accessoryName} to cart`);
                        
                        // Show brief feedback then redirect
                        button.classList.add('added');
                        button.textContent = '✓ Added';
                        
                        setTimeout(() => {
                            openCartPage();
                        }, 500);
                    }
                });
            });
        }
        
        // Cart storage functions
        function addToStoredCart(accessoryName) {
            let cart = JSON.parse(localStorage.getItem('verizonCart') || '{"accessories": []}');
            
            const accessoryMap = {
                'Wall Mounting Bracket': { id: 'wall-mount', name: 'Wall Mounting Bracket', price: 29.99 },
                'Ethernet Cable': { id: 'ethernet-cable', name: 'Ethernet Cable (25ft)', price: 19.99 },
                'Range Extender': { id: 'range-extender', name: '5G Range Extender', price: 149.99 }
            };
            
            const accessory = accessoryMap[accessoryName];
            if (accessory && !cart.accessories.find(acc => acc.id === accessory.id)) {
                cart.accessories.push(accessory);
                localStorage.setItem('verizonCart', JSON.stringify(cart));
                updateCartCounter();
            }
        }
        
        function removeFromStoredCart(accessoryName) {
            let cart = JSON.parse(localStorage.getItem('verizonCart') || '{"accessories": []}');
            
            const accessoryMap = {
                'Wall Mounting Bracket': 'wall-mount',
                'Ethernet Cable': 'ethernet-cable',
                'Range Extender': 'range-extender'
            };
            
            const accessoryId = accessoryMap[accessoryName];
            if (accessoryId) {
                cart.accessories = cart.accessories.filter(acc => acc.id !== accessoryId);
                localStorage.setItem('verizonCart', JSON.stringify(cart));
                updateCartCounter();
            }
        }
        
        function openCartPage() {
            // Open cart page in same window
            window.location.href = 'cart.html';
        }
        
        function openCameraScanner() {
            // Open camera scanner page for existing router owners
            window.location.href = 'camera-scanner.html';
        }
        
        function tryInRoom() {
            // Trigger AR mode for the current page
            const arButton = document.getElementById('ar-button');
            if (arButton) {
                arButton.click();
            }
        }
        
        function updateFloatingButtons(state) {
            const tryArBtn = document.getElementById('try-ar-btn');
            const scanRouterBtn = document.getElementById('scan-router-btn');
            
            if (!tryArBtn || !scanRouterBtn) return;
            
            switch(state) {
                case 'ar-active':
                    // Hide both buttons when AR is active
                    tryArBtn.style.display = 'none';
                    scanRouterBtn.style.display = 'none';
                    break;
                case 'post-purchase':
                    // Show both buttons for post-purchase customers
                    tryArBtn.style.display = 'flex';
                    scanRouterBtn.style.display = 'flex';
                    // Highlight scan button for existing customers
                    scanRouterBtn.style.animation = 'pulse 2s infinite';
                    break;
                case 'normal':
                default:
                    // Show both buttons in normal state
                    tryArBtn.style.display = 'flex';
                    scanRouterBtn.style.display = 'flex';
                    scanRouterBtn.style.animation = 'none';
                    break;
            }
        }

        // --- BUYING EXPERIENCE FUNCTIONALITY ---
        
        let selectedPlan = null;
        let selectedAccessories = [];
        let routerPurchased = false;
        
        // Plan and accessory data
        const plans = {
            basic: { name: "Basic FiOS", speed: "200 Mbps", price: 39.99 },
            gigabit: { name: "Gigabit FiOS", speed: "1000 Mbps", price: 64.99 },
            ultra: { name: "Ultra FiOS", speed: "2000 Mbps", price: 89.99 }
        };
        
        const accessories = {
            mesh: { name: "Mesh Network Extender", price: 149.99, isMonthly: false },
            security: { name: "Advanced Security Package", price: 9.99, isMonthly: true },
            support: { name: "Premium Tech Support", price: 14.99, isMonthly: true },
            cloud: { name: "Cloud Storage Plus", price: 12.99, isMonthly: true }
        };
        
        // Open plan selection modal
        function openPlanModal() {
            const modal = document.getElementById('plan-selection-modal');
            if (modal) {
                modal.style.display = 'block';
                console.log('🛒 Opened plan selection modal');
            }
        }
        
        // Close plan selection modal
        function closePlanModal() {
            const modal = document.getElementById('plan-selection-modal');
            if (modal) {
                modal.style.display = 'none';
                console.log('❌ Closed plan selection modal');
            }
        }
        
        // Setup buying experience
        function setupBuyingExperience() {
            const buyButton = document.getElementById('buy-router-btn');
            if (buyButton) {
                buyButton.addEventListener('click', openPlanModal);
            }
            
            // Plan card selection
            const planCards = document.querySelectorAll('.plan-card');
            planCards.forEach(card => {
                card.addEventListener('click', () => {
                    // Remove selection from other cards
                    planCards.forEach(c => c.classList.remove('selected'));
                    // Select this card
                    card.classList.add('selected');
                    
                    selectedPlan = card.getAttribute('data-plan');
                    updatePurchaseSummary();
                    
                    console.log(`📊 Selected plan: ${selectedPlan}`);
                });
            });
            
            // Accessory card selection
            const accessoryCards = document.querySelectorAll('.accessory-card');
            accessoryCards.forEach(card => {
                card.addEventListener('click', () => {
                    const accessoryId = card.getAttribute('data-accessory');
                    
                    if (card.classList.contains('selected')) {
                        // Deselect
                        card.classList.remove('selected');
                        selectedAccessories = selectedAccessories.filter(id => id !== accessoryId);
                    } else {
                        // Select
                        card.classList.add('selected');
                        selectedAccessories.push(accessoryId);
                    }
                    
                    updatePurchaseSummary();
                    console.log(`🎁 Selected accessories: ${selectedAccessories.join(', ')}`);
                });
            });
            
            // Complete purchase button
            const completePurchaseBtn = document.getElementById('complete-purchase-btn');
            if (completePurchaseBtn) {
                completePurchaseBtn.addEventListener('click', processPurchase);
            }
        }
        
        // Update purchase summary
        function updatePurchaseSummary() {
            const selectedPlanElement = document.getElementById('selected-plan');
            const selectedAccessoriesElement = document.getElementById('selected-accessories');
            const monthlyTotalElement = document.getElementById('monthly-total');
            const todayTotalElement = document.getElementById('today-total');
            const completePurchaseBtn = document.getElementById('complete-purchase-btn');
            
            let monthlyTotal = 0;
            let todayTotal = 399.99; // Router price
            
            // Update plan selection
            if (selectedPlan && plans[selectedPlan]) {
                const plan = plans[selectedPlan];
                selectedPlanElement.innerHTML = `
                    <span>${plan.name} (${plan.speed}):</span>
                    <span>$${plan.price}/mo</span>
                `;
                monthlyTotal += plan.price;
            } else {
                selectedPlanElement.innerHTML = `
                    <span>Internet Plan:</span>
                    <span>Select a plan</span>
                `;
            }
            
            // Update accessories
            selectedAccessoriesElement.innerHTML = '';
            selectedAccessories.forEach(accessoryId => {
                const accessory = accessories[accessoryId];
                if (accessory) {
                    const accessoryElement = document.createElement('div');
                    accessoryElement.className = 'summary-item';
                    
                    if (accessory.isMonthly) {
                        accessoryElement.innerHTML = `
                            <span>${accessory.name}:</span>
                            <span>$${accessory.price}/mo</span>
                        `;
                        monthlyTotal += accessory.price;
                    } else {
                        accessoryElement.innerHTML = `
                            <span>${accessory.name}:</span>
                            <span>$${accessory.price}</span>
                        `;
                        todayTotal += accessory.price;
                    }
                    
                    selectedAccessoriesElement.appendChild(accessoryElement);
                }
            });
            
            // Update totals
            monthlyTotalElement.textContent = `$${monthlyTotal.toFixed(2)}/mo`;
            todayTotalElement.textContent = `$${todayTotal.toFixed(2)}`;
            
            // Enable/disable purchase button
            if (selectedPlan && completePurchaseBtn) {
                completePurchaseBtn.disabled = false;
                completePurchaseBtn.textContent = 'Complete Purchase';
            } else if (completePurchaseBtn) {
                completePurchaseBtn.disabled = true;
                completePurchaseBtn.textContent = 'Select a Plan First';
            }
        }
        
        // Process purchase
        function processPurchase() {
            if (!selectedPlan) {
                alert('Please select an internet plan first.');
                return;
            }
            
            // Close plan modal
            closePlanModal();
            
            // Show loading state
            const buyButton = document.getElementById('buy-router-btn');
            if (buyButton) {
                buyButton.textContent = '⏳ Processing...';
                buyButton.disabled = true;
            }
            
            // Simulate processing time
            setTimeout(() => {
                showPurchaseSuccess();
            }, 2000);
            
            console.log('💳 Processing purchase...', {
                plan: selectedPlan,
                accessories: selectedAccessories
            });
        }
        
        // Show purchase success
        function showPurchaseSuccess() {
            const successModal = document.getElementById('purchase-success-modal');
            if (successModal) {
                successModal.style.display = 'block';
            }
        }
        
        // Complete purchase flow and enable post-purchase features
        function completePurchaseFlow() {
            routerPurchased = true;
            
            // Close success modal
            const successModal = document.getElementById('purchase-success-modal');
            if (successModal) {
                successModal.style.display = 'none';
            }
            
            // Update UI to show purchase completed
            const buyButton = document.getElementById('buy-router-btn');
            if (buyButton) {
                buyButton.textContent = '✅ Router Purchased';
                buyButton.style.background = '#28a745';
                buyButton.disabled = true;
            }
            
            // Add post-purchase hotspots
            addPostPurchaseHotspots();
            
            // Update floating buttons for post-purchase state
            updateFloatingButtons('post-purchase');
            
            console.log('🎉 Purchase completed! Post-purchase features enabled.');
        }
        
        // Add post-purchase interactive hotspots
        function addPostPurchaseHotspots() {
            // Plan management hotspot
            const planHotspot = document.createElement('button');
            planHotspot.className = 'hotspot post-purchase-hotspot';
            planHotspot.setAttribute('slot', 'hotspot-plans');
            planHotspot.setAttribute('data-position', '1.2 0.8 0.5');
            planHotspot.setAttribute('data-normal', '1 0 0');
            planHotspot.id = 'plans-hotspot';
            planHotspot.innerHTML = '<div class="annotation">Manage Plans</div>';
            
            // Upgrade hotspot
            const upgradeHotspot = document.createElement('button');
            upgradeHotspot.className = 'hotspot post-purchase-hotspot';
            upgradeHotspot.setAttribute('slot', 'hotspot-upgrades');
            upgradeHotspot.setAttribute('data-position', '-1.2 0.8 0.5');
            upgradeHotspot.setAttribute('data-normal', '-1 0 0');
            upgradeHotspot.id = 'upgrades-hotspot';
            upgradeHotspot.innerHTML = '<div class="annotation">Available Upgrades</div>';
            
            // Support hotspot
            const supportHotspot = document.createElement('button');
            supportHotspot.className = 'hotspot post-purchase-hotspot';
            supportHotspot.setAttribute('slot', 'hotspot-support');
            supportHotspot.setAttribute('data-position', '0 1.5 0');
            supportHotspot.setAttribute('data-normal', '0 1 0');
            supportHotspot.id = 'support-hotspot';
            supportHotspot.innerHTML = '<div class="annotation">Customer Support</div>';
            
            // Add to model viewer
            modelViewer.appendChild(planHotspot);
            modelViewer.appendChild(upgradeHotspot);
            modelViewer.appendChild(supportHotspot);
            
            // Add event listeners
            planHotspot.addEventListener('click', (e) => {
                e.preventDefault();
                showPlansInfo();
            });
            
            upgradeHotspot.addEventListener('click', (e) => {
                e.preventDefault();
                showUpgradesInfo();
            });
            
            supportHotspot.addEventListener('click', (e) => {
                e.preventDefault();
                showSupportInfo();
            });
            
            console.log('🎯 Post-purchase hotspots added');
        }
        
        // Post-purchase info functions
        function showPlansInfo() {
            const planInfo = plans[selectedPlan];
            alert(`📊 Current Plan: ${planInfo.name}\n\nSpeed: ${planInfo.speed}\nPrice: $${planInfo.price}/month\n\nYou can upgrade or change your plan anytime in your Verizon account.`);
        }
        
        function showUpgradesInfo() {
            alert(`🚀 Available Upgrades:\n\n• Stream more devices with higher speeds\n• Add premium security features\n• Upgrade to Wi-Fi 7 when available\n• Add mesh network coverage\n\nContact support to explore upgrade options!`);
        }
        
        function showSupportInfo() {
            const hasPhysicalRouter = confirm(`🛠️ Customer Support Options:\n\n📞 Call: 1-800-VERIZON\n💬 Chat: Available 24/7 online\n📧 Email: support@verizon.com\n🏪 Store: Find locations near you\n📱 Camera Scanner: Scan your physical router for instant AR help\n\nYour account includes premium support!\n\nDo you have your physical router nearby? Click OK to use our camera scanner feature!`);
            
            if (hasPhysicalRouter) {
                window.open('camera-scanner.html', '_blank');
            }
        }
        
        // Make functions globally accessible
        window.closePlanModal = closePlanModal;
        window.completePurchaseFlow = completePurchaseFlow;

        // --- AR BUTTON FUNCTIONALITY ---
        
        // AR button event listener
        function setupArButton() {
            if (arButton) {
                arButton.addEventListener('click', () => {
                    if (modelViewer.canActivateAR) {
                        console.log('🚀 Activating AR mode');
                        modelViewer.activateAR();
                    } else {
                        console.log('❌ AR not supported on this device');
                        alert('AR is not supported on this device. Please use an AR-capable mobile device with iOS Safari or Android Chrome.');
                    }
                });
            }
        }

        // Initialize all functionality when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setupHotspots();
            setupMenu();
            setupAccessories();
            setupArButton(); // <-- Add this line to initialize AR button functionality
            setupBuyingExperience(); // Initialize buying experience functionality
            updateCartCounter(); // Update cart counter on page load
            checkPurchaseStatus(); // Check if returning from successful purchase
            
            // Initialize floating buttons in normal state
            setTimeout(() => {
                updateFloatingButtons('normal');
            }, 500); // Small delay to ensure elements are ready
            
            console.log('🚀 All interactive features initialized');
        });
        
        // Update cart counter from localStorage
        function updateCartCounter() {
            const cart = JSON.parse(localStorage.getItem('verizonCart') || '{"accessories": []}');
            const cartCount = cart.accessories ? cart.accessories.length : 0;
            const cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                cartCountElement.textContent = cartCount;
            }
        }
        
        // Check if returning from successful purchase
        function checkPurchaseStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const purchased = urlParams.get('purchased');
            const isPurchased = localStorage.getItem('verizonPurchased');
            
            if (purchased === 'true' || isPurchased === 'true') {
                // User completed purchase, show post-purchase hotspots
                setTimeout(() => {
                    addPostPurchaseHotspots();
                    showPurchaseConfirmation();
                    // Update floating buttons for post-purchase customers
                    updateFloatingButtons('post-purchase');
                }, 1000);
                
                // Clean URL
                if (purchased) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
        }
        
        // Show purchase confirmation
        function showPurchaseConfirmation() {
            showInfoModal(`
                <h3 style="color: #28a745; margin-bottom: 20px;">🎉 Purchase Successful!</h3>
                <p style="margin-bottom: 20px;">Thank you for choosing Verizon 5G! Your router and services are being set up.</p>
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #28a745;">
                    <strong>What's Next:</strong><br>
                    • Your 5G router will arrive in 2-3 business days<br>
                    • Installation guide will be included<br>
                    • Your plan will be activated upon device setup<br>
                    • Look for new green hotspots for account management
                </div>
                <p style="color: #aaa; font-size: 14px;">You can manage your account, upgrade services, and get support using the interactive hotspots on your router.</p>
            `);
        }
        
        // Add post-purchase hotspots (green ones)
        function addPostPurchaseHotspots() {
            // Only add if not already present
            if (document.querySelector('.post-purchase-hotspot')) return;
            
            const modelViewer = document.querySelector('model-viewer');
            
            // Account Management hotspot
            const accountHotspot = document.createElement('button');
            accountHotspot.className = 'hotspot post-purchase-hotspot';
            accountHotspot.setAttribute('slot', 'hotspot-account');
            accountHotspot.setAttribute('data-position', '0.8 0.4 0.2');
            accountHotspot.setAttribute('data-normal', '0 1 0');
            accountHotspot.style.background = '#28a745';
            accountHotspot.innerHTML = '💼';
            accountHotspot.addEventListener('click', () => {
                showInfoModal(`
                    <h3 style="color: #28a745;">💼 Account Management</h3>
                    <p>Manage your Verizon 5G account and services:</p>
                    <ul style="text-align: left; margin: 20px 0;">
                        <li>✅ View current plan and usage</li>
                        <li>📱 Manage connected devices</li>
                        <li>💳 Update payment methods</li>
                        <li>📊 View data usage analytics</li>
                        <li>⚙️ Configure network settings</li>
                    </ul>
                    <button onclick="closeInfoModal()" style="background: #28a745; border: none; color: white; padding: 10px 20px; border-radius: 5px; margin-top: 15px;">Access Account</button>
                `);
            });
            
            // Plan Upgrade hotspot
            const upgradeHotspot = document.createElement('button');
            upgradeHotspot.className = 'hotspot post-purchase-hotspot';
            upgradeHotspot.setAttribute('slot', 'hotspot-upgrade');
            upgradeHotspot.setAttribute('data-position', '-0.8 0.4 0.2');
            upgradeHotspot.setAttribute('data-normal', '0 1 0');
            upgradeHotspot.style.background = '#28a745';
            upgradeHotspot.innerHTML = '⬆️';
            upgradeHotspot.addEventListener('click', () => {
                showInfoModal(`
                    <h3 style="color: #28a745;">⬆️ Plan Upgrades</h3>
                    <p>Available upgrade options for your 5G service:</p>
                    <ul style="text-align: left; margin: 20px 0;">
                        <li>🚀 Upgrade to Unlimited Ultimate</li>
                        <li>🔥 Add more hotspot data</li>
                        <li>📺 Include premium streaming</li>
                        <li>🌍 Add international features</li>
                        <li>☁️ Increase cloud storage</li>
                    </ul>
                    <button onclick="closeInfoModal()" style="background: #28a745; border: none; color: white; padding: 10px 20px; border-radius: 5px; margin-top: 15px;">View Upgrades</button>
                `);
            });
            
            // Support hotspot
            const supportHotspot = document.createElement('button');
            supportHotspot.className = 'hotspot post-purchase-hotspot';
            supportHotspot.setAttribute('slot', 'hotspot-support');
            supportHotspot.setAttribute('data-position', '0 0.7 0.8');
            supportHotspot.setAttribute('data-normal', '0 0 1');
            supportHotspot.style.background = '#28a745';
            supportHotspot.innerHTML = '🛠️';
            supportHotspot.addEventListener('click', () => {
                showInfoModal(`
                    <h3 style="color: #28a745;">🛠️ Customer Support</h3>
                    <p>Get help with your Verizon 5G service:</p>
                    <ul style="text-align: left; margin: 20px 0;">
                        <li>📞 24/7 technical support</li>
                        <li>💬 Live chat assistance</li>
                        <li>📖 Setup and troubleshooting guides</li>
                        <li>🔧 Remote diagnostics</li>
                        <li>📍 Find nearest Verizon store</li>
                    </ul>
                    <button onclick="closeInfoModal()" style="background: #28a745; border: none; color: white; padding: 10px 20px; border-radius: 5px; margin-top: 15px;">Get Support</button>
                `);
            });
            
            modelViewer.appendChild(accountHotspot);
            modelViewer.appendChild(upgradeHotspot);
            modelViewer.appendChild(supportHotspot);
            
            console.log('✅ Post-purchase hotspots added');
        }
    </script>

    <!-- Floating Action Buttons -->
    <div class="floating-buttons">
        <button class="floating-btn" id="try-ar-btn" onclick="tryInRoom()">
            <span class="icon">🏠</span>
            Try in Your Room
        </button>
        <button class="floating-btn secondary" id="scan-router-btn" onclick="openCameraScanner()">
            <span class="icon">📱</span>
            Scan Your Router
        </button>
    </div>

</body>
</html>